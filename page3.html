<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cut the Cake — Abhi</title>
<style>
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#5b0b0b,#1f0606);color:#fff}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  .card{width:100%;max-width:520px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.45));padding:18px;border-radius:16px;border:1px solid rgba(255,255,255,0.04)}
  canvas{width:100%;height:260px;border-radius:10px;display:block;touch-action:none}
  .hint{color:#c9bfc6;margin-top:10px}
  .btn{margin-top:12px;padding:10px 14px;border-radius:999px;background:linear-gradient(90deg,#ff3a3a,#ff7b7b);color:#111;border:none;font-weight:800}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="color:#ff6b6b;margin:0 0 8px 0">Cut your birthday cake, hero! ✂️</h2>
      <canvas id="cakeCanvas" class="cake" aria-label="Cake canvas"></canvas>
      <div class="hint">Drag a straight line across the middle of the cake to slice it. Tip: drag straight once.</div>
      <div style="text-align:center"><button class="btn" onclick="location.href='page4.html'">Show Letter</button></div>
    </div>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
(function(){
  const canvas = document.getElementById('cakeCanvas');
  const ctx = canvas.getContext('2d');
  let w = 1200, h = 600;
  function resize(){ const rect = canvas.getBoundingClientRect(); canvas.width = Math.max(600, Math.floor(rect.width*2)); canvas.height = Math.max(300, Math.floor(260*2)); w = canvas.width; h = canvas.height; drawCake(); }
  window.addEventListener('resize', resize);
  function drawCake(){
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = '#071016';
    ctx.fillRect(0,0,w,h);
    const img = new Image(); img.src = 'assets/cake-img.png';
    img.onload = ()=>{
      const scale = Math.min((w*0.75)/img.width, (h*0.7)/img.height);
      const iw = img.width*scale, ih = img.height*scale;
      ctx.drawImage(img, (w-iw)/2, (h-ih)/2, iw, ih);
    };
  }
  resize();

  // simple straight-line slice detection
  let dragging=false, start=null;
  canvas.addEventListener('pointerdown', (e)=>{ dragging=true; const r=canvas.getBoundingClientRect(); start = {x:(e.clientX-r.left)*(canvas.width/r.width), y:(e.clientY-r.top)*(canvas.height/r.height)}; });
  canvas.addEventListener('pointermove', (e)=>{ if(!dragging) return; const r=canvas.getBoundingClientRect(); const p = {x:(e.clientX-r.left)*(canvas.width/r.width), y:(e.clientY-r.top)*(canvas.height/r.height)}; drawCake(); ctx.strokeStyle='rgba(255,255,255,0.9)'; ctx.lineWidth=8; ctx.beginPath(); ctx.moveTo(start.x,start.y); ctx.lineTo(p.x,p.y); ctx.stroke(); });
  canvas.addEventListener('pointerup', (e)=>{ if(!dragging) return; dragging=false; const r=canvas.getBoundingClientRect(); const p = {x:(e.clientX-r.left)*(canvas.width/r.width), y:(e.clientY-r.top)*(canvas.height/r.height)}; const dx = p.x - start.x, dy = p.y - start.y; const angle = Math.abs(Math.atan2(dy,dx)); const centerY = canvas.height/2; const crossesMiddle = ((start.y < centerY && p.y > centerY) || (p.y < centerY && start.y > centerY) || Math.abs((start.y+p.y)/2 - centerY) < canvas.height*0.08); if(angle < Math.PI*0.35 && Math.abs(dx) > canvas.width*0.18 && crossesMiddle){ // success
      // confetti
      for(let i=0;i<12;i++){ const d=document.createElement('div'); d.textContent='✨'; d.style.position='fixed'; d.style.left=(window.innerWidth/2 + (Math.random()-0.5)*260)+'px'; d.style.top=(window.innerHeight/2 + (Math.random()-0.5)*160)+'px'; d.style.zIndex=9999; document.body.appendChild(d); gsap.to(d,{y:-240,opacity:0,duration:1.2,rotation:Math.random()*360,onComplete:()=>d.remove()}); }
      // play memories
      const a = new Audio('audio/memories.mp3'); a.play().catch(()=>{});
    } else { drawCake(); }});
})();
</script>
</body>
</html>
